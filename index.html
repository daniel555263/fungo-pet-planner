<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FunGo å® ç‰©æ—…è¡Œè§„åˆ’å™¨</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif; 
      background: #f8f9fb;
      min-height: 100vh;
      color: #1d1d1f;
      line-height: 1.4;
    }
    
    @keyframes spin { 
      to { transform: rotate(360deg); } 
    }
    
    @keyframes fadeInUp { 
      from { opacity: 0; transform: translateY(30px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .spin { animation: spin 1s linear infinite; }
    .fade-in { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1); }
    .slide-in { animation: slideInLeft 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    .pulse { animation: pulse 2s infinite; }
    
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // è·å–å½“å‰æ—¶æ®µ
    const getCurrentTimeSlot = () => {
      const hour = new Date().getHours();
      if (hour >= 6 && hour < 9) return { slot: 'morning', label: 'æ—©æ™¨', icon: 'ğŸŒ…', activity: 'æ™¨ç»ƒé›ç‹—' };
      if (hour >= 9 && hour < 12) return { slot: 'forenoon', label: 'ä¸Šåˆ', icon: 'â˜€ï¸', activity: 'æˆ·å¤–æ´»åŠ¨' };
      if (hour >= 12 && hour < 14) return { slot: 'noon', label: 'ä¸­åˆ', icon: 'ğŸŒ', activity: 'ä¼‘é—²æ—¶å…‰' };
      if (hour >= 14 && hour < 17) return { slot: 'afternoon', label: 'ä¸‹åˆ', icon: 'ğŸŒ¤ï¸', activity: 'æ¢ç´¢æ¸¸ç©' };
      if (hour >= 17 && hour < 19) return { slot: 'evening', label: 'å‚æ™š', icon: 'ğŸŒ†', activity: 'æ•£æ­¥æ—¶é—´' };
      if (hour >= 19 && hour < 22) return { slot: 'night', label: 'å¤œæ™š', icon: 'ğŸŒƒ', activity: 'å¤œæ¸¸ä½“éªŒ' };
      return { slot: 'late', label: 'æ·±å¤œ', icon: 'ğŸŒ™', activity: 'å®‰é™ä¼‘æ¯' };
    };

    // æ•°æ®é…ç½®
    const CONFIG = {
      cities: {
        major: [
          { name: 'åŒ—äº¬', districts: ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'è¥¿åŸåŒº', 'ä¸œåŸåŒº'], weather: 'â˜€ï¸', temp: '24Â°C', lat: 39.9042, lng: 116.4074 },
          { name: 'ä¸Šæµ·', districts: ['æµ¦ä¸œæ–°åŒº', 'é»„æµ¦åŒº', 'é™å®‰åŒº', 'å¾æ±‡åŒº'], weather: 'â›…', temp: '26Â°C', lat: 31.2304, lng: 121.4737 },
          { name: 'å¹¿å·', districts: ['å¤©æ²³åŒº', 'è¶Šç§€åŒº', 'æµ·ç åŒº', 'è”æ¹¾åŒº'], weather: 'ğŸŒ¦ï¸', temp: '29Â°C', lat: 23.1291, lng: 113.2644 },
          { name: 'æ·±åœ³', districts: ['å—å±±åŒº', 'ç¦ç”°åŒº', 'ç½—æ¹–åŒº', 'å®å®‰åŒº'], weather: 'â˜€ï¸', temp: '28Â°C', lat: 22.5431, lng: 114.0579 },
          { name: 'æ­å·', districts: ['è¥¿æ¹–åŒº', 'æ‹±å¢…åŒº', 'æ±Ÿå¹²åŒº', 'ä¸‹åŸåŒº'], weather: 'ğŸŒ¦ï¸', temp: '22Â°C', lat: 30.2741, lng: 120.1551 },
          { name: 'æˆéƒ½', districts: ['é”¦æ±ŸåŒº', 'é’ç¾ŠåŒº', 'é‡‘ç‰›åŒº', 'æ­¦ä¾¯åŒº'], weather: 'â˜ï¸', temp: '20Â°C', lat: 30.5728, lng: 104.0668 },
          { name: 'å—äº¬', districts: ['ç„æ­¦åŒº', 'ç§¦æ·®åŒº', 'å»ºé‚ºåŒº', 'é¼“æ¥¼åŒº'], weather: 'â›…', temp: '23Â°C', lat: 32.0603, lng: 118.7969 },
          { name: 'æ­¦æ±‰', districts: ['æ±Ÿæ±‰åŒº', 'æ±Ÿå²¸åŒº', 'ç¡šå£åŒº', 'æ±‰é˜³åŒº'], weather: 'ğŸŒ¤ï¸', temp: '25Â°C', lat: 30.5928, lng: 114.3055 }
        ]
      },
      interests: [
        { id: 'beach', label: 'ç©æ°´å¬‰æˆ', icon: 'ğŸ–ï¸' },
        { id: 'run', label: 'ç‹—ç‹—å¥”è·‘', icon: 'ğŸƒ' },
        { id: 'cafe', label: 'å–ä¸‹åˆèŒ¶', icon: 'â˜•' },
        { id: 'park', label: 'å…¬å›­æ¼«æ­¥', icon: 'ğŸŒ³' },
        { id: 'photo', label: 'æ‹ç…§æ‰“å¡', icon: 'ğŸ“¸' },
        { id: 'food', label: 'ç¾é£Ÿæ¢åº—', icon: 'ğŸ½ï¸' },
        { id: 'mountain', label: 'ç™»å±±å¾’æ­¥', icon: 'ğŸ”ï¸' },
        { id: 'lake', label: 'æ¹–è¾¹ä¼‘é—²', icon: 'ğŸï¸' }
      ],
      durations: [
        { value: '2', label: '2å¤©1å¤œ', desc: 'å‘¨æœ«çŸ­é€”' },
        { value: '3', label: '3å¤©2å¤œ', desc: 'å°é•¿å‡' },
        { value: '5', label: '5å¤©4å¤œ', desc: 'æ·±åº¦æ¸¸' },
        { value: '7', label: '7å¤©6å¤œ', desc: 'åº¦å‡æ¸¸' }
      ],
      // æ¨¡æ‹Ÿåœ°ç‚¹æ•°æ®
      mockPlaces: {
        'æ·±åœ³-å—å±±åŒº': [
          { id: 1, name: 'æ·±åœ³æ¹¾å…¬å›­', type: 'park', distance: 1.2, rating: 4.8, petFriendly: 5, time: 'å…¨å¤©', features: ['å® ç‰©ä¸“åŒº', 'æµ·æ»¨æ­¥é“'] },
          { id: 2, name: 'MUJIå’–å•¡', type: 'cafe', distance: 0.8, rating: 4.6, petFriendly: 4, time: '10:00-22:00', features: ['å® ç‰©å‹å¥½', 'ä¸‹åˆèŒ¶'] },
          { id: 3, name: 'æ¬¢ä¹æµ·å²¸', type: 'food', distance: 2.1, rating: 4.7, petFriendly: 4, time: '10:00-22:00', features: ['æˆ·å¤–åº§ä½', 'ç¾é£Ÿè¡—'] },
          { id: 4, name: 'å¤§å—å±±', type: 'mountain', distance: 5.2, rating: 4.9, petFriendly: 5, time: 'å…¨å¤©', features: ['ç™»å±±æ­¥é“', 'è§‚æ™¯å°'] },
          { id: 5, name: 'è¥¿ä¸½æ¹–', type: 'lake', distance: 8.5, rating: 4.5, petFriendly: 5, time: '06:00-18:00', features: ['æ¹–è¾¹æ ˆé“', 'è‰åª'] }
        ],
        'åŒ—äº¬-æœé˜³åŒº': [
          { id: 11, name: 'æœé˜³å…¬å›­', type: 'park', distance: 1.5, rating: 4.7, petFriendly: 5, time: 'å…¨å¤©', features: ['å¤§è‰åª', 'å® ç‰©è®­ç»ƒåŒº'] },
          { id: 12, name: 'ä¸‰é‡Œå±¯å’–å•¡å…', type: 'cafe', distance: 2.3, rating: 4.5, petFriendly: 4, time: '08:00-22:00', features: ['éœ²å¤©åº§ä½', 'å® ç‰©é¤å…·'] },
          { id: 13, name: 'å¥¥æ—åŒ¹å…‹å…¬å›­', type: 'park', distance: 8.7, rating: 4.9, petFriendly: 5, time: 'å…¨å¤©', features: ['å¹¿é˜”ç©ºé—´', 'æ™¯è§‚æ¹–'] }
        ],
        'ä¸Šæµ·-æµ¦ä¸œæ–°åŒº': [
          { id: 21, name: 'ä¸–çºªå…¬å›­', type: 'park', distance: 2.1, rating: 4.8, petFriendly: 5, time: 'å…¨å¤©', features: ['æ¨±èŠ±å¤§é“', 'å® ç‰©ä¹å›­'] },
          { id: 22, name: 'é™†å®¶å˜´å’–å•¡', type: 'cafe', distance: 1.8, rating: 4.6, petFriendly: 4, time: '07:00-21:00', features: ['æ±Ÿæ™¯åº§ä½', 'å® ç‰©å‹å¥½'] },
          { id: 23, name: 'æ»¨æ±Ÿå¤§é“', type: 'photo', distance: 3.2, rating: 4.7, petFriendly: 4, time: 'å…¨å¤©', features: ['é»„æµ¦æ±Ÿæ™¯', 'å¤œæ™¯æ‹ç…§'] }
        ]
      },
      // æ¨¡æ‹Ÿé…’åº—æ•°æ®
      mockHotels: [
        { id: 'h1', name: 'æ·±åœ³æ¹¾å® ç‰©å‹å¥½é…’åº—', price: 688, rating: 4.8, petFee: 100, features: ['å® ç‰©SPA', 'ä¸“å±æˆ¿é—´', '24hæœåŠ¡'], image: 'ğŸ¨' },
        { id: 'h2', name: 'å¸Œå°”é¡¿æ¬¢æœ‹é…’åº—', price: 528, rating: 4.6, petFee: 80, features: ['å® ç‰©åºŠå«', 'é›ç‹—åŒºåŸŸ', 'å® ç‰©é¤å…·'], image: 'ğŸ¢' },
        { id: 'h3', name: 'æ°‘å®¿Â·æ¯›å­©å­ä¹‹å®¶', price: 398, rating: 4.9, petFee: 0, features: ['ç‹¬æ ‹åˆ«å¢…', 'ç§äººèŠ±å›­', 'å® ç‰©æ¸¸æ³³æ± '], image: 'ğŸ¡' }
      ]
    };

    const App = () => {
      // æ ¸å¿ƒçŠ¶æ€
      const [page, setPage] = useState('planning');
      const [tripType, setTripType] = useState('local');
      const [selectedCity, setSelectedCity] = useState('æ·±åœ³');
      const [selectedDistrict, setSelectedDistrict] = useState('å—å±±åŒº');
      const [duration, setDuration] = useState('');
      const [pets, setPets] = useState([{ 
        id: 1, name: 'æ—ºè´¢', type: 'é‡‘æ¯›', emoji: 'ğŸ•', weight: '25kg' 
      }]);
      const [preferences, setPreferences] = useState([]);
      const [savedPlans, setSavedPlans] = useState([]);
      const [currentPlan, setCurrentPlan] = useState(null);
      
      // UI çŠ¶æ€
      const [showAddPet, setShowAddPet] = useState(false);
      const [showCitySelect, setShowCitySelect] = useState(false);
      const [showMapView, setShowMapView] = useState(false);
      const [newPet, setNewPet] = useState({ name: '', type: '', weight: '' });
      const [loading, setLoading] = useState(false);
      const [animationClass, setAnimationClass] = useState('');

      const currentTimeSlot = getCurrentTimeSlot();

      useEffect(() => {
        setAnimationClass('fade-in');
      }, []);

      // è®¡ç®—å±æ€§
      const currentCityData = useMemo(() => 
        CONFIG.cities.major.find(city => city.name === selectedCity) || CONFIG.cities.major[3], 
        [selectedCity]
      );

      const isFormValid = useMemo(() => 
        selectedCity && tripType && pets.length > 0 && 
        (tripType === 'local' || duration), 
        [selectedCity, tripType, pets.length, duration]
      );

      // è·å–æ™ºèƒ½æ¨èæ–¹æ¡ˆï¼ˆæ‰¾äº‹åšæ¨¡å¼ï¼‰
      const getLocalPlans = useCallback(() => {
        const places = CONFIG.mockPlaces[`${selectedCity}-${selectedDistrict}`] || CONFIG.mockPlaces['æ·±åœ³-å—å±±åŒº'];
        
        // æ ¹æ®æ—¶æ®µã€å…´è¶£å’Œè·ç¦»æ’åº
        let filteredPlaces = [...places];
        
        // æ ¹æ®å…´è¶£è¿‡æ»¤
        if (preferences.length > 0) {
          const interestMap = {
            'ç©æ°´å¬‰æˆ': ['beach', 'lake'],
            'ç‹—ç‹—å¥”è·‘': ['park', 'mountain'],
            'å–ä¸‹åˆèŒ¶': ['cafe'],
            'å…¬å›­æ¼«æ­¥': ['park'],
            'æ‹ç…§æ‰“å¡': ['park', 'beach', 'mountain', 'photo'],
            'ç¾é£Ÿæ¢åº—': ['food'],
            'ç™»å±±å¾’æ­¥': ['mountain'],
            'æ¹–è¾¹ä¼‘é—²': ['lake']
          };
          
          filteredPlaces = filteredPlaces.filter(place => {
            return preferences.some(pref => {
              const types = interestMap[pref] || [];
              return types.includes(place.type);
            });
          });
        }
        
        // æŒ‰è·ç¦»æ’åº
        filteredPlaces.sort((a, b) => a.distance - b.distance);
        
        // ç”Ÿæˆ3ä¸ªæ–¹æ¡ˆ
        return filteredPlaces.slice(0, 3).map((place, index) => ({
          id: `local-${index}`,
          place,
          title: place.name,
          subtitle: `è·ç¦» ${place.distance}km Â· ${place.time}`,
          type: 'local',
          features: place.features,
          rating: place.rating,
          petFriendly: place.petFriendly,
          timeRecommend: index === 0 ? currentTimeSlot.activity : null
        }));
      }, [selectedCity, selectedDistrict, preferences, currentTimeSlot]);

      // è·å–è§„åˆ’æ¸¸æ–¹æ¡ˆ
      const getTravelPlans = useCallback(() => {
        const hotels = CONFIG.mockHotels;
        const places = CONFIG.mockPlaces[`${selectedCity}-${selectedDistrict}`] || CONFIG.mockPlaces['æ·±åœ³-å—å±±åŒº'];
        
        return hotels.slice(0, 2).map((hotel, index) => ({
          id: `travel-${index}`,
          hotel,
          title: `${duration}å¤©${parseInt(duration) - 1}å¤œ Â· ${hotel.name}`,
          subtitle: `Â¥${hotel.price}/æ™š Â· å® ç‰©è´¹Â¥${hotel.petFee}`,
          type: 'travel',
          places: places.slice(0, 3),
          totalPrice: hotel.price * (parseInt(duration) - 1) + hotel.petFee,
          features: hotel.features,
          rating: hotel.rating
        }));
      }, [selectedCity, selectedDistrict, duration]);

      // äº‹ä»¶å¤„ç†
      const handleTripTypeChange = (type) => {
        setTripType(type);
        if (type === 'local') {
          setDuration('');
        }
      };

      const handleAddPet = () => {
        if (newPet.name && newPet.type && newPet.weight) {
          setPets(prev => [...prev, { 
            ...newPet, 
            id: Date.now(), 
            emoji: 'ğŸ•' 
          }]);
          setNewPet({ name: '', type: '', weight: '' });
          setShowAddPet(false);
        }
      };

      const handleRemovePet = (id) => {
        if (pets.length > 1) {
          setPets(prev => prev.filter(p => p.id !== id));
        }
      };

      const handleToggleInterest = (interest) => {
        setPreferences(prev => 
          prev.includes(interest) 
            ? prev.filter(p => p !== interest)
            : [...prev, interest]
        );
      };

      const handleCitySelect = (city, district) => {
        setSelectedCity(city);
        setSelectedDistrict(district);
        setShowCitySelect(false);
      };

      const handleSavePlan = (plan) => {
        setSavedPlans(prev => {
          const exists = prev.find(p => p.id === plan.id);
          if (exists) {
            return prev.filter(p => p.id !== plan.id);
          } else {
            return [...prev, { ...plan, savedAt: new Date().toISOString() }];
          }
        });
      };

      const generatePlans = () => {
        if (!isFormValid) return;
        setLoading(true);
        setTimeout(() => {
          setLoading(false);
          setPage('plans');
        }, 1000);
      };

      // Appleé£æ ¼æ ·å¼ç³»ç»Ÿ
      const styles = {
        container: { 
          background: '#f8f9fb', 
          minHeight: '100vh',
          paddingBottom: '100px'
        },
        header: { 
          background: 'rgba(255, 255, 255, 0.95)', 
          backdropFilter: 'saturate(180%) blur(20px)',
          WebkitBackdropFilter: 'saturate(180%) blur(20px)',
          padding: '12px 20px', 
          borderBottom: '0.5px solid rgba(0,0,0,0.05)',
          position: 'sticky', 
          top: 0, 
          zIndex: 100
        },
        logo: { 
          fontSize: '24px', 
          fontWeight: '700', 
          textAlign: 'center',
          letterSpacing: '-0.5px'
        },
        content: {
          padding: '20px 20px 0',
          maxWidth: '600px',
          margin: '0 auto'
        },
        section: {
          marginBottom: '28px'
        },
        sectionTitle: {
          fontSize: '20px',
          fontWeight: '600',
          color: '#1d1d1f',
          marginBottom: '14px',
          letterSpacing: '-0.3px'
        },
        button: { 
          padding: '14px 20px', 
          background: '#007aff', 
          color: 'white', 
          border: 'none', 
          borderRadius: '10px', 
          fontSize: '16px', 
          fontWeight: '600', 
          width: '100%',
          transition: 'all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
          cursor: 'pointer',
          fontFamily: 'inherit'
        },
        buttonSecondary: {
          background: '#f2f2f7',
          color: '#007aff',
          border: '0.5px solid rgba(0,0,0,0.04)'
        },
        grid2: { 
          display: 'grid', 
          gridTemplateColumns: '1fr 1fr', 
          gap: '10px' 
        },
        grid3: { 
          display: 'grid', 
          gridTemplateColumns: 'repeat(3, 1fr)', 
          gap: '10px' 
        },
        modal: { 
          position: 'fixed', 
          top: 0, 
          left: 0, 
          right: 0, 
          bottom: 0, 
          background: 'rgba(0,0,0,0.4)', 
          display: 'flex', 
          alignItems: 'center',
          justifyContent: 'center',
          padding: '20px',
          zIndex: 1000,
          backdropFilter: 'blur(8px)',
          WebkitBackdropFilter: 'blur(8px)'
        },
        modalContent: { 
          background: 'white', 
          borderRadius: '16px', 
          padding: '24px 20px', 
          width: '100%',
          maxWidth: '380px',
          maxHeight: '80vh',
          overflowY: 'auto'
        },
        input: { 
          width: '100%', 
          padding: '14px 16px', 
          border: '0.5px solid #d1d1d6', 
          borderRadius: '10px', 
          fontSize: '16px', 
          marginBottom: '12px', 
          outline: 'none',
          transition: 'all 0.2s ease',
          fontFamily: 'inherit',
          background: 'white'
        },
        bottomBar: { 
          position: 'fixed', 
          bottom: 0, 
          left: 0, 
          right: 0, 
          padding: '16px 20px', 
          background: 'rgba(255, 255, 255, 0.95)',
          backdropFilter: 'saturate(180%) blur(20px)',
          WebkitBackdropFilter: 'saturate(180%) blur(20px)',
          borderTop: '0.5px solid rgba(0,0,0,0.05)'
        }
      };

      // å¡ç‰‡é€‰æ‹©ç»„ä»¶
      const SelectableCard = ({ 
        selected, 
        onClick, 
        children, 
        size = 'medium',
        disabled = false 
      }) => {
        const cardStyle = {
          padding: size === 'large' ? '18px' : size === 'small' ? '14px' : '16px',
          borderRadius: '10px',
          cursor: disabled ? 'not-allowed' : 'pointer',
          transition: 'all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
          border: '0.5px solid',
          borderColor: selected ? '#007aff' : 'rgba(0,0,0,0.08)',
          background: selected ? '#007aff' : 'white',
          color: selected ? 'white' : '#1d1d1f',
          transform: selected ? 'scale(0.98)' : 'scale(1)',
          opacity: disabled ? 0.5 : 1
        };

        return (
          <div 
            onClick={disabled ? undefined : onClick}
            style={cardStyle}
          >
            {children}
          </div>
        );
      };

      // ä½ç½®å¡ç‰‡ç»„ä»¶
      const LocationCard = () => {
        const [isHovered, setIsHovered] = useState(false);
        
        return (
          <div 
            onClick={() => setShowCitySelect(true)}
            style={{
              background: 'white',
              borderRadius: '14px',
              padding: '18px',
              marginBottom: '20px',
              border: '0.5px solid rgba(0,0,0,0.04)',
              cursor: 'pointer',
              transition: 'all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
              transform: isHovered ? 'translateY(-2px)' : 'translateY(0)',
              boxShadow: isHovered ? '0 8px 25px rgba(0,0,0,0.1)' : '0 2px 8px rgba(0,0,0,0.04)'
            }}
            onMouseEnter={() => setIsHovered(true)}
            onMouseLeave={() => setIsHovered(false)}
          >
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '14px' }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                <div style={{ fontSize: '18px' }}>ğŸ“</div>
                <div>
                  <div style={{ fontSize: '17px', fontWeight: '600', color: '#1d1d1f' }}>
                    {selectedCity} Â· {selectedDistrict}
                  </div>
                  <div style={{ fontSize: '13px', color: '#86868b', marginTop: '2px' }}>
                    {currentTimeSlot.icon} {currentTimeSlot.label} Â· å½“å‰ä½ç½®
                  </div>
                </div>
              </div>
              <div style={{ fontSize: '16px', color: '#007aff' }}>â€º</div>
            </div>
            <div style={{ 
              padding: '10px 14px',
              background: 'rgba(0, 122, 255, 0.08)',
              borderRadius: '8px',
              display: 'flex', 
              alignItems: 'center', 
              gap: '10px',
              fontSize: '14px'
            }}>
              <span>{currentCityData.weather}</span>
              <span style={{ fontWeight: '500', color: '#007aff' }}>{currentCityData.temp}</span>
              <span style={{ color: '#86868b' }}>é€‚å®œå‡ºè¡Œ</span>
            </div>
          </div>
        );
      };

      // æ–¹æ¡ˆå¡ç‰‡ç»„ä»¶ï¼ˆæ‰¾äº‹åšæ¨¡å¼ï¼‰
      const LocalPlanCard = ({ plan, onSave, isSaved, onPreview }) => {
        return (
          <div style={{
            background: 'white',
            borderRadius: '14px',
            overflow: 'hidden',
            marginBottom: '14px',
            border: '0.5px solid rgba(0,0,0,0.04)',
            boxShadow: '0 2px 8px rgba(0,0,0,0.04)',
            transition: 'all 0.2s ease'
          }}>
            {/* æ—¶æ®µæ¨èæ ‡ç­¾ */}
            {plan.timeRecommend && (
              <div style={{
                background: 'linear-gradient(135deg, #30d158, #34c759)',
                color: 'white',
                padding: '8px 14px',
                fontSize: '12px',
                fontWeight: '600',
                display: 'flex',
                alignItems: 'center',
                gap: '6px'
              }}>
                {currentTimeSlot.icon} {plan.timeRecommend}æ¨è
              </div>
            )}
            
            <div style={{ padding: '16px' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>
                <div style={{ flex: 1 }}>
                  <h3 style={{ fontSize: '17px', fontWeight: '600', color: '#1d1d1f', marginBottom: '4px' }}>
                    {plan.title}
                  </h3>
                  <p style={{ fontSize: '13px', color: '#86868b' }}>
                    {plan.subtitle}
                  </p>
                </div>
              </div>
              
              {/* è¯„åˆ†å’Œå® ç‰©å‹å¥½åº¦ */}
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '10px' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                  <span style={{ fontSize: '13px', color: '#86868b' }}>è¯„åˆ†</span>
                  <span style={{ fontSize: '14px', fontWeight: '500', color: '#1d1d1f' }}>{plan.rating}</span>
                  <span style={{ fontSize: '12px', color: '#ffa726' }}>â˜…</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                  <span style={{ fontSize: '13px', color: '#86868b' }}>å® ç‰©å‹å¥½</span>
                  <div style={{ display: 'flex', gap: '1px' }}>
                    {[1,2,3,4,5].map(i => (
                      <span key={i} style={{ 
                        fontSize: '10px', 
                        color: i <= plan.petFriendly ? '#007aff' : '#e0e0e0' 
                      }}>
                        ğŸ¾
                      </span>
                    ))}
                  </div>
                </div>
              </div>
              
              {/* ç‰¹è‰²æ ‡ç­¾ */}
              <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', marginBottom: '12px' }}>
                {plan.features?.map((feature, idx) => (
                  <span key={idx} style={{
                    background: 'rgba(0, 122, 255, 0.08)',
                    color: '#007aff',
                    padding: '3px 8px',
                    borderRadius: '4px',
                    fontSize: '11px',
                    fontWeight: '500'
                  }}>
                    {feature}
                  </span>
                ))}
              </div>
              
              {/* æ“ä½œæŒ‰é’® */}
              <div style={{ display: 'flex', gap: '8px' }}>
                <button
                  onClick={() => onPreview(plan)}
                  style={{
                    flex: 1,
                    padding: '10px',
                    background: '#f2f2f7',
                    color: '#007aff',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer'
                  }}
                >
                  é¢„è§ˆè¯¦æƒ…
                </button>
                <button
                  onClick={() => onSave(plan)}
                  style={{
                    padding: '10px 16px',
                    background: isSaved ? '#30d158' : '#007aff',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '4px'
                  }}
                >
                  {isSaved ? 'âœ“ å·²æ”¶è—' : 'æ”¶è—'}
                </button>
              </div>
            </div>
          </div>
        );
      };

      // è§„åˆ’æ¸¸æ–¹æ¡ˆå¡ç‰‡
      const TravelPlanCard = ({ plan, onSave, isSaved, onPreview, onBookHotel }) => {
        return (
          <div style={{
            background: 'white',
            borderRadius: '14px',
            overflow: 'hidden',
            marginBottom: '14px',
            border: '0.5px solid rgba(0,0,0,0.04)',
            boxShadow: '0 2px 8px rgba(0,0,0,0.04)'
          }}>
            {/* é…’åº—ä¿¡æ¯ */}
            <div style={{
              background: 'linear-gradient(135deg, #007aff, #5ac8fa)',
              padding: '16px',
              color: 'white'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                <div style={{ fontSize: '32px' }}>{plan.hotel.image}</div>
                <div style={{ flex: 1 }}>
                  <h3 style={{ fontSize: '17px', fontWeight: '600', marginBottom: '4px' }}>
                    {plan.hotel.name}
                  </h3>
                  <div style={{ fontSize: '13px', opacity: 0.9 }}>
                    {plan.title}
                  </div>
                </div>
              </div>
            </div>
            
            <div style={{ padding: '16px' }}>
              {/* ä»·æ ¼ä¿¡æ¯ */}
              <div style={{
                background: 'rgba(255, 149, 0, 0.1)',
                borderRadius: '8px',
                padding: '10px',
                marginBottom: '12px',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <div>
                  <div style={{ fontSize: '20px', fontWeight: '700', color: '#ff9500' }}>
                    Â¥{plan.totalPrice}
                  </div>
                  <div style={{ fontSize: '12px', color: '#86868b' }}>
                    {plan.subtitle}
                  </div>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '2px' }}>
                  {[1,2,3,4,5].map(i => (
                    <span key={i} style={{ 
                      fontSize: '12px', 
                      color: i <= plan.rating ? '#ffa726' : '#e0e0e0' 
                    }}>â˜…</span>
                  ))}
                </div>
              </div>
              
              {/* é…’åº—ç‰¹è‰² */}
              <div style={{ marginBottom: '12px' }}>
                <div style={{ fontSize: '14px', fontWeight: '500', color: '#1d1d1f', marginBottom: '6px' }}>
                  é…’åº—ç‰¹è‰²
                </div>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                  {plan.features?.map((feature, idx) => (
                    <span key={idx} style={{
                      background: 'rgba(0, 122, 255, 0.08)',
                      color: '#007aff',
                      padding: '3px 8px',
                      borderRadius: '4px',
                      fontSize: '11px',
                      fontWeight: '500'
                    }}>
                      {feature}
                    </span>
                  ))}
                </div>
              </div>
              
              {/* åŒ…å«æ™¯ç‚¹ */}
              <div style={{ marginBottom: '12px' }}>
                <div style={{ fontSize: '14px', fontWeight: '500', color: '#1d1d1f', marginBottom: '6px' }}>
                  å‘¨è¾¹æ™¯ç‚¹
                </div>
                <div style={{ fontSize: '12px', color: '#86868b', lineHeight: '1.5' }}>
                  {plan.places?.map(p => p.name).join(' Â· ')}
                </div>
              </div>
              
              {/* æ“ä½œæŒ‰é’® */}
              <div style={{ display: 'flex', gap: '8px' }}>
                <button
                  onClick={() => onPreview(plan)}
                  style={{
                    flex: 1,
                    padding: '10px',
                    background: '#f2f2f7',
                    color: '#007aff',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer'
                  }}
                >
                  é¢„è§ˆè¡Œç¨‹
                </button>
                <button
                  onClick={() => onBookHotel(plan.hotel)}
                  style={{
                    flex: 1,
                    padding: '10px',
                    background: '#ff9500',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer'
                  }}
                >
                  ä¸€é”®é¢„è®¢
                </button>
                <button
                  onClick={() => onSave(plan)}
                  style={{
                    padding: '10px 16px',
                    background: isSaved ? '#30d158' : '#007aff',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer'
                  }}
                >
                  {isSaved ? 'âœ“' : 'æ”¶è—'}
                </button>
              </div>
            </div>
          </div>
        );
      };

      // åœ°å›¾è§†å›¾ç»„ä»¶
      const MapView = ({ places, onClose }) => {
        return (
          <div style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'white',
            zIndex: 2000
          }}>
            {/* åœ°å›¾å¤´éƒ¨ */}
            <div style={{
              position: 'absolute',
              top: 0,
              left: 0,
              right: 0,
              background: 'rgba(255, 255, 255, 0.95)',
              backdropFilter: 'blur(20px)',
              WebkitBackdropFilter: 'blur(20px)',
              padding: '12px 20px',
              borderBottom: '0.5px solid rgba(0,0,0,0.05)',
              zIndex: 10,
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between'
            }}>
              <button
                onClick={onClose}
                style={{
                  background: 'none',
                  border: 'none',
                  fontSize: '16px',
                  color: '#007aff',
                  cursor: 'pointer',
                  padding: '4px'
                }}
              >
                å®Œæˆ
              </button>
              <div style={{ fontSize: '17px', fontWeight: '600' }}>åœ°å›¾è§†å›¾</div>
              <div style={{ width: '40px' }}></div>
            </div>
            
            {/* æ¨¡æ‹Ÿåœ°å›¾ */}
            <div style={{
              width: '100%',
              height: '100%',
              background: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',
              position: 'relative',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center'
            }}>
              <div style={{
                fontSize: '48px',
                color: '#007aff',
                textAlign: 'center'
              }}>
                ğŸ—ºï¸
                <div style={{ fontSize: '16px', marginTop: '12px', color: '#1d1d1f' }}>
                  åœ°å›¾åŠ è½½ä¸­...
                </div>
              </div>
              
              {/* åœ°ç‚¹æ ‡è®° */}
              {places?.map((place, index) => (
                <div
                  key={place.id}
                  style={{
                    position: 'absolute',
                    left: `${20 + (index * 25)}%`,
                    top: `${30 + (index * 15)}%`,
                    background: '#007aff',
                    color: 'white',
                    padding: '6px 10px',
                    borderRadius: '20px',
                    fontSize: '12px',
                    fontWeight: '500',
                    boxShadow: '0 2px 8px rgba(0,0,0,0.2)'
                  }}
                >
                  {index + 1} {place.name}
                </div>
              ))}
            </div>
          </div>
        );
      };

      // é¢„è§ˆè¯¦æƒ…ç»„ä»¶
      const PlanPreview = ({ plan, onClose, onSave, isSaved }) => {
        const places = plan.type === 'local' ? [plan.place] : plan.places;
        
        return (
          <div style={styles.modal}>
            <div style={{
              ...styles.modalContent,
              maxWidth: '500px',
              maxHeight: '90vh'
            }}>
              {/* å¤´éƒ¨ */}
              <div style={{ 
                display: 'flex', 
                justifyContent: 'space-between', 
                alignItems: 'center', 
                marginBottom: '20px',
                paddingBottom: '12px',
                borderBottom: '0.5px solid rgba(0,0,0,0.05)'
              }}>
                <h3 style={{ fontSize: '18px', fontWeight: '600', color: '#1d1d1f' }}>
                  {plan.type === 'local' ? 'æ´»åŠ¨è¯¦æƒ…' : 'è¡Œç¨‹é¢„è§ˆ'}
                </h3>
                <button 
                  onClick={onClose} 
                  style={{ 
                    background: 'none', 
                    border: 'none', 
                    fontSize: '24px', 
                    color: '#86868b',
                    cursor: 'pointer'
                  }}
                >
                  Ã—
                </button>
              </div>
              
              {/* åœ°å›¾é¢„è§ˆ */}
              <div 
                onClick={() => setShowMapView(true)}
                style={{
                  height: '120px',
                  background: 'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)',
                  borderRadius: '10px',
                  marginBottom: '16px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  cursor: 'pointer',
                  position: 'relative',
                  overflow: 'hidden'
                }}
              >
                <div style={{ textAlign: 'center', zIndex: 1 }}>
                  <div style={{ fontSize: '32px', marginBottom: '4px' }}>ğŸ—ºï¸</div>
                  <div style={{ fontSize: '12px', color: '#007aff', fontWeight: '500' }}>
                    ç‚¹å‡»æŸ¥çœ‹åœ°å›¾
                  </div>
                </div>
                {/* åœ°ç‚¹æ ‡è®° */}
                {places?.slice(0, 3).map((place, index) => (
                  <div
                    key={index}
                    style={{
                      position: 'absolute',
                      left: `${15 + (index * 30)}%`,
                      top: `${20 + (index * 20)}%`,
                      width: '8px',
                      height: '8px',
                      background: '#007aff',
                      borderRadius: '50%',
                      border: '2px solid white',
                      boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                    }}
                  />
                ))}
              </div>
              
              {/* å†…å®¹ */}
              {plan.type === 'local' ? (
                <div>
                  <h4 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '8px' }}>
                    {plan.place.name}
                  </h4>
                  <div style={{ fontSize: '13px', color: '#86868b', lineHeight: '1.5', marginBottom: '12px' }}>
                    <div>ğŸ“ è·ç¦»: {plan.place.distance}km</div>
                    <div>â° å¼€æ”¾æ—¶é—´: {plan.place.time}</div>
                    <div>â­ è¯„åˆ†: {plan.place.rating}</div>
                    <div>ğŸ¾ å® ç‰©å‹å¥½åº¦: {'ğŸ¾'.repeat(plan.place.petFriendly)}</div>
                  </div>
                  <div style={{ marginBottom: '12px' }}>
                    <div style={{ fontSize: '14px', fontWeight: '500', marginBottom: '6px' }}>ç‰¹è‰²</div>
                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                      {plan.place.features?.map((f, i) => (
                        <span key={i} style={{
                          background: 'rgba(0, 122, 255, 0.08)',
                          color: '#007aff',
                          padding: '3px 8px',
                          borderRadius: '4px',
                          fontSize: '11px'
                        }}>{f}</span>
                      ))}
                    </div>
                  </div>
                </div>
              ) : (
                <div>
                  <div style={{ marginBottom: '16px' }}>
                    <h4 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '8px' }}>
                      ä½å®¿å®‰æ’
                    </h4>
                    <div style={{
                      background: '#f8f9fb',
                      borderRadius: '8px',
                      padding: '12px'
                    }}>
                      <div style={{ fontSize: '15px', fontWeight: '500', marginBottom: '4px' }}>
                        {plan.hotel.name}
                      </div>
                      <div style={{ fontSize: '13px', color: '#86868b' }}>
                        Â¥{plan.hotel.price}/æ™š Â· å® ç‰©è´¹ Â¥{plan.hotel.petFee}
                      </div>
                    </div>
                  </div>
                  
                  <div>
                    <h4 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '8px' }}>
                      è¡Œç¨‹å®‰æ’
                    </h4>
                    {places?.map((place, index) => (
                      <div key={index} style={{
                        background: '#f8f9fb',
                        borderRadius: '8px',
                        padding: '12px',
                        marginBottom: '8px'
                      }}>
                        <div style={{ fontSize: '14px', fontWeight: '500', marginBottom: '4px' }}>
                          Day {Math.floor(index / 2) + 1} - {place.name}
                        </div>
                        <div style={{ fontSize: '12px', color: '#86868b' }}>
                          è·ç¦» {place.distance}km Â· {place.time}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              
              {/* åº•éƒ¨æŒ‰é’® */}
              <div style={{ marginTop: '20px', paddingTop: '16px', borderTop: '0.5px solid rgba(0,0,0,0.05)' }}>
                <button
                  onClick={() => onSave(plan)}
                  style={{
                    ...styles.button,
                    background: isSaved ? '#30d158' : '#007aff'
                  }}
                >
                  {isSaved ? 'âœ“ å·²æ”¶è—åˆ°è¡Œç¨‹' : 'æ”¶è—åˆ°æˆ‘çš„è¡Œç¨‹'}
                </button>
              </div>
            </div>
          </div>
        );
      };

      // é¡µé¢æ¸²æŸ“é€»è¾‘
      if (page === 'planning') {
        return (
          <div style={styles.container} className={animationClass}>
            {/* å¤´éƒ¨ */}
            <div style={styles.header}>
              <div style={styles.logo}>
                <span style={{ color: '#1d1d1f' }}>Fun</span>
                <span style={{ color: '#007aff' }}>Go</span>
              </div>
            </div>

            <div style={styles.content}>
              {/* å‡ºè¡Œç±»å‹ */}
              <div style={styles.section}>
                <div style={styles.sectionTitle}>ä»Šå¤©æƒ³åšä»€ä¹ˆï¼Ÿ</div>
                <div style={styles.grid2}>
                  {[
                    { type: 'local', icon: 'ğŸ¯', label: 'æ‰¾äº‹åš', desc: 'é™„è¿‘æ´»åŠ¨' },
                    { type: 'travel', icon: 'ğŸ“…', label: 'è§„åˆ’æ¸¸', desc: 'å¤šæ—¥è¡Œç¨‹' }
                  ].map(item => (
                    <SelectableCard 
                      key={item.type}
                      selected={tripType === item.type}
                      onClick={() => handleTripTypeChange(item.type)}
                      size="large"
                    >
                      <div style={{ textAlign: 'center' }}>
                        <div style={{ fontSize: '28px', marginBottom: '10px' }}>{item.icon}</div>
                        <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '3px' }}>
                          {item.label}
                        </div>
                        <div style={{ fontSize: '12px', opacity: 0.7 }}>{item.desc}</div>
                      </div>
                    </SelectableCard>
                  ))}
                </div>
              </div>

              {/* ä½ç½®é€‰æ‹© */}
              <div style={styles.section}>
                <div style={styles.sectionTitle}>
                  {tripType === 'local' ? 'æˆ‘åœ¨å“ªé‡Œ' : 'å»å“ªé‡Œç©'}
                </div>
                <LocationCard />
                
                {tripType === 'local' && (
                  <div>
                    <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '12px', color: '#1d1d1f' }}>
                      æˆ‘çš„å…´è¶£
                    </div>
                    <div style={styles.grid3}>
                      {CONFIG.interests.map(item => (
                        <SelectableCard 
                          key={item.id}
                          selected={preferences.includes(item.label)}
                          onClick={() => handleToggleInterest(item.label)}
                          size="small"
                        >
                          <div style={{ textAlign: 'center' }}>
                            <div style={{ fontSize: '20px', marginBottom: '6px' }}>{item.icon}</div>
                            <div style={{ fontSize: '11px', fontWeight: '500', lineHeight: '1.2' }}>
                              {item.label}
                            </div>
                          </div>
                        </SelectableCard>
                      ))}
                    </div>
                  </div>
                )}
                
                {tripType === 'travel' && (
                  <div>
                    <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '12px', color: '#1d1d1f' }}>
                      å‡ºè¡Œå¤©æ•°
                    </div>
                    <div style={styles.grid2}>
                      {CONFIG.durations.map(item => (
                        <SelectableCard 
                          key={item.value}
                          selected={duration === item.value}
                          onClick={() => setDuration(item.value)}
                        >
                          <div>
                            <div style={{ fontWeight: '600', fontSize: '16px', marginBottom: '3px' }}>
                              {item.label}
                            </div>
                            <div style={{ fontSize: '12px', opacity: 0.7 }}>
                              {item.desc}
                            </div>
                          </div>
                        </SelectableCard>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              {/* å® ç‰©ä¿¡æ¯ */}
              <div style={styles.section}>
                <div style={styles.sectionTitle}>æˆ‘çš„ä¼™ä¼´</div>
                
                {pets.map(pet => (
                  <div key={pet.id} style={{
                    display: 'flex', 
                    alignItems: 'center', 
                    gap: '14px', 
                    padding: '16px',
                    background: 'white', 
                    borderRadius: '12px', 
                    marginBottom: '10px',
                    border: '0.5px solid rgba(0,0,0,0.04)'
                  }}>
                    <div style={{
                      fontSize: '24px', 
                      width: '48px', 
                      height: '48px', 
                      background: '#f2f2f7', 
                      borderRadius: '50%', 
                      display: 'flex', 
                      alignItems: 'center', 
                      justifyContent: 'center'
                    }}>
                      {pet.emoji}
                    </div>
                    <div style={{ flex: 1 }}>
                      <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '2px', color: '#1d1d1f' }}>
                        {pet.name}
                      </div>
                      <div style={{ fontSize: '14px', color: '#86868b' }}>
                        {pet.type} Â· {pet.weight}
                      </div>
                    </div>
                    {pets.length > 1 && (
                      <button 
                        onClick={() => handleRemovePet(pet.id)} 
                        style={{ 
                          background: 'none', 
                          border: 'none', 
                          color: '#ff3b30', 
                          fontSize: '18px',
                          cursor: 'pointer',
                          padding: '6px'
                        }}
                      >
                        Ã—
                      </button>
                    )}
                  </div>
                ))}
                
                <button 
                  onClick={() => setShowAddPet(true)} 
                  style={{
                    ...styles.button,
                    ...styles.buttonSecondary,
                    fontSize: '15px'
                  }}
                >
                  + æ·»åŠ å® ç‰©
                </button>
              </div>

              {/* å·²æ”¶è—è®¡åˆ’ */}
              {savedPlans.length > 0 && (
                <div style={styles.section}>
                  <div style={styles.sectionTitle}>
                    æˆ‘çš„æ”¶è— ({savedPlans.length})
                  </div>
                  <div style={{
                    background: 'white',
                    borderRadius: '12px',
                    padding: '12px',
                    border: '0.5px solid rgba(0,0,0,0.04)'
                  }}>
                    {savedPlans.map((plan, index) => (
                      <div key={plan.id} style={{
                        fontSize: '14px',
                        padding: '8px 0',
                        borderBottom: index < savedPlans.length - 1 ? '0.5px solid rgba(0,0,0,0.05)' : 'none'
                      }}>
                        {plan.title}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* åº•éƒ¨æ“ä½œæ  */}
            <div style={styles.bottomBar}>
              <button 
                onClick={generatePlans} 
                disabled={!isFormValid} 
                style={{
                  ...styles.button,
                  background: isFormValid ? '#007aff' : '#d1d1d6',
                  color: isFormValid ? 'white' : '#86868b',
                  cursor: isFormValid ? 'pointer' : 'not-allowed'
                }}
              >
                {loading ? (
                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
                    <div className="spin" style={{ 
                      width: '14px', 
                      height: '14px', 
                      border: '2px solid rgba(255,255,255,0.3)', 
                      borderTop: '2px solid white', 
                      borderRadius: '50%' 
                    }}></div>
                    ç”Ÿæˆä¸­...
                  </div>
                ) : (
                  tripType === 'local' ? 'æ™ºèƒ½æ¨è' : 'ç”Ÿæˆè¡Œç¨‹'
                )}
              </button>
            </div>

            {/* æ¨¡æ€æ¡†ï¼šæ·»åŠ å® ç‰© */}
            {showAddPet && (
              <div style={styles.modal} onClick={(e) => e.target === e.currentTarget && setShowAddPet(false)}>
                <div style={styles.modalContent}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                    <h3 style={{ fontSize: '18px', fontWeight: '600', color: '#1d1d1f' }}>æ·»åŠ å® ç‰©</h3>
                    <button 
                      onClick={() => setShowAddPet(false)} 
                      style={{ 
                        background: 'none', 
                        border: 'none', 
                        fontSize: '22px', 
                        color: '#86868b',
                        cursor: 'pointer'
                      }}
                    >
                      Ã—
                    </button>
                  </div>
                  <input 
                    type="text" 
                    placeholder="å® ç‰©åå­—" 
                    value={newPet.name} 
                    onChange={(e) => setNewPet({...newPet, name: e.target.value})} 
                    style={styles.input}
                  />
                  <input 
                    type="text" 
                    placeholder="å“ç§" 
                    value={newPet.type} 
                    onChange={(e) => setNewPet({...newPet, type: e.target.value})} 
                    style={styles.input}
                  />
                  <input 
                    type="text" 
                    placeholder="ä½“é‡" 
                    value={newPet.weight} 
                    onChange={(e) => setNewPet({...newPet, weight: e.target.value})} 
                    style={styles.input}
                  />
                  <button 
                    onClick={handleAddPet} 
                    style={styles.button}
                  >
                    ç¡®è®¤æ·»åŠ 
                  </button>
                </div>
              </div>
            )}

            {/* æ¨¡æ€æ¡†ï¼šåŸå¸‚é€‰æ‹© */}
            {showCitySelect && (
              <div style={styles.modal} onClick={(e) => e.target === e.currentTarget && setShowCitySelect(false)}>
                <div style={styles.modalContent}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
                    <h3 style={{ fontSize: '18px', fontWeight: '600', color: '#1d1d1f' }}>é€‰æ‹©ä½ç½®</h3>
                    <button 
                      onClick={() => setShowCitySelect(false)} 
                      style={{ 
                        background: 'none', 
                        border: 'none', 
                        fontSize: '22px', 
                        color: '#86868b',
                        cursor: 'pointer'
                      }}
                    >
                      Ã—
                    </button>
                  </div>
                  
                  <div style={{ maxHeight: '60vh', overflowY: 'auto' }}>
                    {CONFIG.cities.major.map(city => (
                      <div key={city.name} style={{ marginBottom: '16px' }}>
                        <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '10px', color: '#1d1d1f', display: 'flex', alignItems: 'center', gap: '8px' }}>
                          {city.name} 
                          <span style={{ fontSize: '13px', color: '#86868b' }}>{city.weather} {city.temp}</span>
                        </div>
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '8px' }}>
                          {city.districts.map(district => (
                            <button
                              key={district}
                              onClick={() => handleCitySelect(city.name, district)}
                              style={{
                                padding: '12px 14px',
                                background: selectedCity === city.name && selectedDistrict === district 
                                  ? '#007aff' 
                                  : 'white',
                                color: selectedCity === city.name && selectedDistrict === district ? 'white' : '#1d1d1f',
                                border: '0.5px solid',
                                borderColor: selectedCity === city.name && selectedDistrict === district ? '#007aff' : 'rgba(0,0,0,0.08)',
                                borderRadius: '8px',
                                fontSize: '14px',
                                fontWeight: '500',
                                cursor: 'pointer',
                                transition: 'all 0.2s ease',
                                fontFamily: 'inherit'
                              }}
                            >
                              {district}
                            </button>
                          ))}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      // æ–¹æ¡ˆæ¨èé¡µé¢
      if (page === 'plans') {
        const plans = tripType === 'local' ? getLocalPlans() : getTravelPlans();
        
        return (
          <div style={styles.container} className="fade-in">
            <div style={styles.header}>
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <button 
                  onClick={() => setPage('planning')}
                  style={{
                    background: 'none',
                    border: 'none',
                    fontSize: '16px',
                    color: '#007aff',
                    cursor: 'pointer',
                    padding: '4px'
                  }}
                >
                  â€¹ è¿”å›
                </button>
                <div style={{ fontSize: '17px', fontWeight: '600', color: '#1d1d1f' }}>
                  {tripType === 'local' ? 'ä»Šæ—¥æ¨è' : 'è¡Œç¨‹æ–¹æ¡ˆ'}
                </div>
                <button 
                  onClick={() => setShowMapView(true)}
                  style={{
                    background: 'none',
                    border: 'none',
                    fontSize: '20px',
                    cursor: 'pointer',
                    padding: '4px'
                  }}
                >
                  ğŸ—ºï¸
                </button>
              </div>
            </div>

            <div style={styles.content}>
              {/* æ™ºèƒ½æç¤º */}
              {tripType === 'local' && (
                <div style={{
                  background: 'linear-gradient(135deg, rgba(48, 209, 88, 0.1), rgba(52, 199, 89, 0.1))',
                  borderRadius: '10px',
                  padding: '14px',
                  marginBottom: '16px',
                  border: '1px solid rgba(48, 209, 88, 0.2)'
                }}>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <span style={{ fontSize: '16px' }}>{currentTimeSlot.icon}</span>
                    <div>
                      <div style={{ fontSize: '14px', fontWeight: '600', color: '#1d1d1f' }}>
                        {currentTimeSlot.label}å¥½ï¼Œ{pets[0]?.name || 'æ‚¨çš„å® ç‰©'}ï¼
                      </div>
                      <div style={{ fontSize: '12px', color: '#86868b', marginTop: '2px' }}>
                        æ ¹æ®å½“å‰æ—¶é—´å’Œæ‚¨çš„ä½ç½®ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹æ´»åŠ¨
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {/* æ–¹æ¡ˆåˆ—è¡¨ */}
              <div style={styles.section}>
                {tripType === 'local' ? (
                  // æ‰¾äº‹åšæ¨¡å¼
                  plans.map((plan, index) => (
                    <div key={plan.id} className="slide-in" style={{ animationDelay: `${index * 0.1}s` }}>
                      <LocalPlanCard 
                        plan={plan}
                        isSaved={savedPlans.some(p => p.id === plan.id)}
                        onSave={handleSavePlan}
                        onPreview={(plan) => setCurrentPlan(plan)}
                      />
                    </div>
                  ))
                ) : (
                  // è§„åˆ’æ¸¸æ¨¡å¼
                  plans.map((plan, index) => (
                    <div key={plan.id} className="slide-in" style={{ animationDelay: `${index * 0.1}s` }}>
                      <TravelPlanCard 
                        plan={plan}
                        isSaved={savedPlans.some(p => p.id === plan.id)}
                        onSave={handleSavePlan}
                        onPreview={(plan) => setCurrentPlan(plan)}
                        onBookHotel={(hotel) => {
                          alert(`é¢„è®¢ ${hotel.name}\nä»·æ ¼: Â¥${hotel.price}/æ™š\nå® ç‰©è´¹: Â¥${hotel.petFee}`);
                        }}
                      />
                    </div>
                  ))
                )}
              </div>

              {/* åŠ è½½æ›´å¤š */}
              <div style={{ textAlign: 'center', marginTop: '20px' }}>
                <button
                  style={{
                    background: 'none',
                    border: 'none',
                    color: '#007aff',
                    fontSize: '14px',
                    fontWeight: '500',
                    cursor: 'pointer',
                    padding: '8px 16px'
                  }}
                  onClick={() => alert('åŠ è½½æ›´å¤šæ¨è')}
                >
                  æŸ¥çœ‹æ›´å¤š â†’
                </button>
              </div>
            </div>

            {/* åº•éƒ¨çŠ¶æ€æ  */}
            <div style={styles.bottomBar}>
              <div style={{ 
                display: 'flex', 
                alignItems: 'center', 
                justifyContent: 'space-between',
                fontSize: '14px'
              }}>
                <div style={{ color: '#86868b' }}>
                  å·²æ”¶è— {savedPlans.length} ä¸ªæ–¹æ¡ˆ
                </div>
                {savedPlans.length > 0 && (
                  <button
                    onClick={() => {
                      alert(`å·²æ”¶è—çš„æ–¹æ¡ˆ:\n${savedPlans.map(p => p.title).join('\n')}`);
                    }}
                    style={{
                      background: '#007aff',
                      color: 'white',
                      border: 'none',
                      borderRadius: '8px',
                      padding: '8px 16px',
                      fontSize: '14px',
                      fontWeight: '500',
                      cursor: 'pointer'
                    }}
                  >
                    æŸ¥çœ‹æ”¶è—
                  </button>
                )}
              </div>
            </div>

            {/* é¢„è§ˆè¯¦æƒ… */}
            {currentPlan && (
              <PlanPreview 
                plan={currentPlan}
                onClose={() => setCurrentPlan(null)}
                onSave={handleSavePlan}
                isSaved={savedPlans.some(p => p.id === currentPlan.id)}
              />
            )}

            {/* åœ°å›¾è§†å›¾ */}
            {showMapView && (
              <MapView 
                places={tripType === 'local' ? plans.map(p => p.place) : plans[0]?.places}
                onClose={() => setShowMapView(false)}
              />
            )}
          </div>
        );
      }

      return null;
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
